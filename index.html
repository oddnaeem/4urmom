<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡¶∏‡ßç‡¶•‡¶æ‡¶®‡ßÄ‡ßü ‡¶â‡¶á‡¶ï‡¶ø</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      background: #f9f9f9;
    }

    header {
      background: #3366cc;
      color: white;
      padding: 10px;
      text-align: center;
    }

    nav {
      display: flex;
      justify-content: space-between;
      background: #eee;
      padding: 10px;
      flex-wrap: wrap;
    }

    nav button {
      padding: 6px 12px;
      margin: 2px;
    }

    main {
      padding: 10px;
    }

    .hidden {
      display: none;
    }

    .article {
      background: white;
      padding: 10px;
      margin: 10px 0;
      border-radius: 8px;
      box-shadow: 0 0 4px rgba(0,0,0,0.1);
    }

    textarea, input[type="text"], input[type="password"] {
      width: 100%;
      padding: 10px;
      margin: 6px 0;
      box-sizing: border-box;
    }

    .admin-btn {
      color: red;
      cursor: pointer;
      font-weight: bold;
    }

    #search-box {
      width: 100%;
      padding: 8px;
      margin: 10px 0;
      font-size: 16px;
    }

    @media screen and (max-width: 600px) {
      nav {
        flex-direction: column;
        gap: 5px;
      }
    }
  </style>
</head>
<body>

<header>
  <h1>‡¶∏‡ßç‡¶•‡¶æ‡¶®‡ßÄ‡ßü ‡¶â‡¶á‡¶ï‡¶ø</h1>
</header>

<nav>
  <div id="user-info">‡¶Ö‡¶§‡¶ø‡¶•‡¶ø</div>
  <div>
    <button onclick="showLogin()">‡¶≤‡¶ó‡¶á‡¶®</button>
    <button onclick="showRegister()">‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞</button>
    <button onclick="logout()">‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
  </div>
</nav>

<main>
  <input type="text" id="search-box" placeholder="üîç ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶ï‡¶∞‡ßÅ‡¶®..." oninput="renderArticles()">

  <section id="auth-section" class="hidden">
    <h3 id="auth-title">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
    <input type="text" id="username" placeholder="‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ">
    <input type="password" id="password" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°">
    <button onclick="submitAuth()">‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®</button>
  </section>

  <section id="editor-section" class="hidden">
    <h3>‡¶®‡¶§‡ßÅ‡¶®/‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶ø‡¶§ ‡¶™‡ßç‡¶∞‡¶¨‡¶®‡ßç‡¶ß</h3>
    <input type="text" id="article-title" placeholder="‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ">
    <textarea id="article-content" rows="6" placeholder="**‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡¶°‡¶æ‡¶â‡¶®** ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..."></textarea>
    <button onclick="saveArticle()">‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    <div id="preview-box" class="article hidden"></div>
  </section>

  <button onclick="showEditor()">‚úçÔ∏è ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßç‡¶∞‡¶¨‡¶®‡ßç‡¶ß ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®</button>

  <section id="articles-section"></section>
</main>

<script>
  let currentUser = null;
  let editId = null;

  function init() {
    const user = localStorage.getItem("sessionUser");
    if (user) {
      currentUser = JSON.parse(user);
      updateUserInfo();
    }
    renderArticles();
  }

  function updateUserInfo() {
    const info = document.getElementById("user-info");
    info.innerText = currentUser ? `${currentUser.username} (${currentUser.role})` : "‡¶Ö‡¶§‡¶ø‡¶•‡¶ø";
  }

  function showLogin() {
    document.getElementById("auth-section").classList.remove("hidden");
    document.getElementById("auth-title").innerText = "‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®";
  }

  function showRegister() {
    document.getElementById("auth-section").classList.remove("hidden");
    document.getElementById("auth-title").innerText = "‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®";
  }

  function logout() {
    localStorage.removeItem("sessionUser");
    currentUser = null;
    updateUserInfo();
    renderArticles();
  }

  function submitAuth() {
    const uname = document.getElementById("username").value;
    const pass = document.getElementById("password").value;
    const title = document.getElementById("auth-title").innerText;

    const users = JSON.parse(localStorage.getItem("users") || "[]");

    if (title.includes("‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞")) {
      if (users.some(u => u.username === uname)) {
        alert("‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá ‡¶•‡ßá‡¶ï‡ßá‡¶á ‡¶Ü‡¶õ‡ßá");
        return;
      }
      const role = uname === "admin" ? "admin" : "user";
      users.push({ username: uname, password: pass, role });
      localStorage.setItem("users", JSON.stringify(users));
      alert("‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶∏‡¶´‡¶≤!");
    }

    const found = users.find(u => u.username === uname && u.password === pass);
    if (found) {
      localStorage.setItem("sessionUser", JSON.stringify(found));
      currentUser = found;
      updateUserInfo();
      document.getElementById("auth-section").classList.add("hidden");
      renderArticles();
    } else {
      alert("‡¶≠‡ßÅ‡¶≤ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ ‡¶¨‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°!");
    }
  }

  function showEditor(id = null) {
    document.getElementById("editor-section").classList.remove("hidden");
    const preview = document.getElementById("preview-box");
    preview.innerHTML = "";
    preview.classList.add("hidden");

    if (id !== null) {
      const articles = JSON.parse(localStorage.getItem("articles") || "[]");
      const a = articles.find(a => a.id === id);
      document.getElementById("article-title").value = a.title;
      document.getElementById("article-content").value = a.content;
      editId = id;
    } else {
      editId = null;
      document.getElementById("article-title").value = "";
      document.getElementById("article-content").value = "";
    }
  }

  function saveArticle() {
    const title = document.getElementById("article-title").value;
    const content = document.getElementById("article-content").value;
    if (!title || !content) return alert("‡¶´‡¶æ‡¶Å‡¶ï‡¶æ ‡¶∞‡¶æ‡¶ñ‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ");

    const articles = JSON.parse(localStorage.getItem("articles") || "[]");

    if (editId !== null) {
      const idx = articles.findIndex(a => a.id === editId);
      if (idx >= 0) {
        if (currentUser.username !== articles[idx].author && currentUser.role !== "admin") {
          return alert("‡¶è‡¶á ‡¶Ü‡¶∞‡ßç‡¶ü‡¶ø‡¶ï‡ßá‡¶≤ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶® ‡¶®‡¶æ");
        }
        articles[idx].title = title;
        articles[idx].content = content;
      }
    } else {
      const id = Date.now();
      articles.push({ id, title, content, author: currentUser.username });
    }

    localStorage.setItem("articles", JSON.stringify(articles));
    document.getElementById("editor-section").classList.add("hidden");
    renderArticles();
  }

  function renderArticles() {
    const section = document.getElementById("articles-section");
    section.innerHTML = "";

    const searchText = document.getElementById("search-box")?.value.toLowerCase() || "";
    const articles = JSON.parse(localStorage.getItem("articles") || "[]");

    const filtered = articles.filter(article =>
      article.title.toLowerCase().includes(searchText) ||
      article.content.toLowerCase().includes(searchText)
    );

    filtered.forEach(article => {
      const div = document.createElement("div");
      div.className = "article";
      div.innerHTML = `
        <h3>${article.title}</h3>
        <div>${renderMarkdown(article.content)}</div>
        <small>‡¶≤‡¶ø‡¶ñ‡ßá‡¶õ‡ßá‡¶®: ${article.author}</small><br/>
        ${canEdit(article) ? `<button onclick="showEditor(${article.id})">‚úèÔ∏è</button>` : ""}
        ${canDelete(article) ? `<span class="admin-btn" onclick="deleteArticle(${article.id})">üóëÔ∏è</span>` : ""}
      `;
      section.appendChild(div);
    });
  }

  function canEdit(article) {
    return currentUser && (currentUser.username === article.author || currentUser.role === "admin");
  }

  function canDelete(article) {
    return currentUser && currentUser.role === "admin";
  }

  function deleteArticle(id) {
    let articles = JSON.parse(localStorage.getItem("articles") || "[]");
    articles = articles.filter(a => a.id !== id);
    localStorage.setItem("articles", JSON.stringify(articles));
    renderArticles();
  }

  function renderMarkdown(md) {
    return md
      .replace(/^### (.*$)/gim, '<h3>$1</h3>')
      .replace(/^## (.*$)/gim, '<h2>$1</h2>')
      .replace(/^# (.*$)/gim, '<h1>$1</h1>')
      .replace(/\*\*(.*?)\*\*/gim, '<strong>$1</strong>')
      .replace(/\*(.*?)\*/gim, '<em>$1</em>')
      .replace(/\n/g, '<br/>');
  }

  document.getElementById("article-content").addEventListener("input", function () {
    const content = this.value;
    const preview = document.getElementById("preview-box");
    preview.classList.remove("hidden");
    preview.innerHTML = renderMarkdown(content);
  });

  init();
</script>
</body>
</html>
