<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <title>‡¶∏‡ßç‡¶•‡¶æ‡¶®‡ßÄ‡ßü ‡¶â‡¶á‡¶ï‡¶ø</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 0;
    }
    header {
      background: #ffffff;
      border-bottom: 1px solid #ccc;
      padding: 10px 20px;
      text-align: center;
    }
    nav {
      background: #e9e9e9;
      padding: 10px 20px;
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
    }
    nav button {
      margin: 2px;
      padding: 6px 10px;
    }
    main {
      max-width: 800px;
      margin: auto;
      padding: 15px;
      background: white;
    }
    .hidden { display: none; }
    .article {
      border: 1px solid #ddd;
      padding: 10px;
      margin-top: 10px;
      background: #fff;
      border-radius: 5px;
    }
    textarea, input[type=text], input[type=password] {
      width: 100%;
      padding: 8px;
      margin: 5px 0;
    }
    .admin-btn {
      color: red;
      cursor: pointer;
    }
    #search-box {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
    }
    a {
      color: #0645ad;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    @media (max-width: 600px) {
      nav {
        flex-direction: column;
        gap: 5px;
      }
    }
  </style>
</head>
<body>

<header>
  <h1><a href="#" onclick="renderArticles()">‡¶∏‡ßç‡¶•‡¶æ‡¶®‡ßÄ‡ßü ‡¶â‡¶á‡¶ï‡¶ø</a></h1>
</header>

<nav>
  <div id="user-info">‡¶Ö‡¶§‡¶ø‡¶•‡¶ø</div>
  <div>
    <button onclick="showLogin()">‡¶≤‡¶ó‡¶á‡¶®</button>
    <button onclick="showRegister()">‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞</button>
    <button onclick="logout()">‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
    <button onclick="showEditor()">‚úçÔ∏è ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßç‡¶∞‡¶¨‡¶®‡ßç‡¶ß</button>
  </div>
</nav>

<main>
  <input id="search-box" type="text" placeholder="üîç ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶ï‡¶∞‡ßÅ‡¶®..." oninput="renderArticles()">

  <section id="auth-section" class="hidden">
    <h3 id="auth-title">‡¶≤‡¶ó‡¶á‡¶®</h3>
    <input id="username" type="text" placeholder="‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ">
    <input id="password" type="password" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°">
    <button onclick="submitAuth()">‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®</button>
  </section>

  <section id="editor-section" class="hidden">
    <h3>‡¶™‡ßç‡¶∞‡¶¨‡¶®‡ßç‡¶ß ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶ï</h3>
    <input id="article-title" type="text" placeholder="‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ">
    <textarea id="article-content" rows="8" placeholder="**‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡¶°‡¶æ‡¶â‡¶®** ‡¶¶‡¶ø‡ßü‡ßá ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..."></textarea>
    <button onclick="saveArticle()">‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£</button>
    <div id="preview-box" class="article hidden"></div>
  </section>

  <section id="articles-section"></section>
</main>

<script>
  let currentUser = null;
  let editId = null;

  function init() {
    const user = localStorage.getItem("sessionUser");
    if (user) currentUser = JSON.parse(user);
    updateUserInfo();
    renderArticles();
  }

  function updateUserInfo() {
    document.getElementById("user-info").innerText = currentUser ? `${currentUser.username} (${currentUser.role})` : "‡¶Ö‡¶§‡¶ø‡¶•‡¶ø";
  }

  function showLogin() {
    document.getElementById("auth-title").innerText = "‡¶≤‡¶ó‡¶á‡¶®";
    document.getElementById("auth-section").classList.remove("hidden");
  }

  function showRegister() {
    document.getElementById("auth-title").innerText = "‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞";
    document.getElementById("auth-section").classList.remove("hidden");
  }

  function logout() {
    localStorage.removeItem("sessionUser");
    currentUser = null;
    updateUserInfo();
    renderArticles();
  }

  function submitAuth() {
    const uname = document.getElementById("username").value.trim();
    const pass = document.getElementById("password").value.trim();
    const isRegister = document.getElementById("auth-title").innerText === "‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞";

    let users = JSON.parse(localStorage.getItem("users") || "[]");

    if (isRegister) {
      if (users.some(u => u.username === uname)) return alert("‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá ‡¶•‡ßá‡¶ï‡ßá‡¶á ‡¶Ü‡¶õ‡ßá");
      const role = uname === "admin" ? "admin" : "user";
      users.push({ username: uname, password: pass, role });
      localStorage.setItem("users", JSON.stringify(users));
      alert("‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®!");
    }

    const found = users.find(u => u.username === uname && u.password === pass);
    if (found) {
      currentUser = found;
      localStorage.setItem("sessionUser", JSON.stringify(found));
      updateUserInfo();
      document.getElementById("auth-section").classList.add("hidden");
      renderArticles();
    } else {
      alert("‡¶≤‡¶ó‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•!");
    }
  }

  function showEditor(id = null) {
    document.getElementById("editor-section").classList.remove("hidden");
    const preview = document.getElementById("preview-box");
    preview.classList.add("hidden");
    if (id) {
      const articles = JSON.parse(localStorage.getItem("articles") || "[]");
      const a = articles.find(a => a.id === id);
      document.getElementById("article-title").value = a.title;
      document.getElementById("article-content").value = a.content;
      editId = id;
    } else {
      editId = null;
      document.getElementById("article-title").value = "";
      document.getElementById("article-content").value = "";
    }
  }

  function saveArticle() {
    const title = document.getElementById("article-title").value.trim();
    const content = document.getElementById("article-content").value.trim();
    if (!title || !content) return alert("‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ ‡¶ì ‡¶ï‡¶®‡¶ü‡ßá‡¶®‡ßç‡¶ü ‡¶¶‡¶ø‡¶§‡ßá ‡¶π‡¶¨‡ßá");

    let articles = JSON.parse(localStorage.getItem("articles") || "[]");

    if (editId) {
      const idx = articles.findIndex(a => a.id === editId);
      if (idx !== -1) {
        if (currentUser.username !== articles[idx].author && currentUser.role !== "admin") {
          return alert("‡¶Ü‡¶™‡¶®‡¶ø ‡¶è‡¶ü‡¶ø ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶® ‡¶®‡¶æ");
        }
        articles[idx].title = title;
        articles[idx].content = content;
      }
    } else {
      const id = Date.now();
      articles.push({ id, title, content, author: currentUser.username });
    }

    localStorage.setItem("articles", JSON.stringify(articles));
    document.getElementById("editor-section").classList.add("hidden");
    renderArticles();
  }

  function renderArticles() {
    const list = document.getElementById("articles-section");
    list.innerHTML = "";

    const q = document.getElementById("search-box").value.toLowerCase();
    const articles = JSON.parse(localStorage.getItem("articles") || "[]");

    const filtered = articles.filter(a =>
      a.title.toLowerCase().includes(q) || a.content.toLowerCase().includes(q)
    );

    filtered.forEach(article => {
      const div = document.createElement("div");
      div.className = "article";
      div.innerHTML = `
        <h2>${article.title}</h2>
        <div>${renderMarkdown(article.content)}</div>
        <small>‡¶≤‡¶ø‡¶ñ‡ßá‡¶õ‡ßá‡¶®: ${article.author}</small><br>
        ${canEdit(article) ? `<button onclick="showEditor(${article.id})">‚úèÔ∏è ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ</button>` : ""}
        ${canDelete(article) ? `<button class="admin-btn" onclick="deleteArticle(${article.id})">üóëÔ∏è ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>` : ""}
      `;
      list.appendChild(div);
    });
  }

  function canEdit(article) {
    return currentUser && (currentUser.username === article.author || currentUser.role === "admin");
  }

  function canDelete(article) {
    return currentUser && currentUser.role === "admin";
  }

  function deleteArticle(id) {
    let articles = JSON.parse(localStorage.getItem("articles") || "[]");
    articles = articles.filter(a => a.id !== id);
    localStorage.setItem("articles", JSON.stringify(articles));
    renderArticles();
  }

  function renderMarkdown(md) {
    return md
      .replace(/^### (.*$)/gim, '<h3>$1</h3>')
      .replace(/^## (.*$)/gim, '<h2>$1</h2>')
      .replace(/^# (.*$)/gim, '<h1>$1</h1>')
      .replace(/\*\*(.*?)\*\*/gim, '<strong>$1</strong>')
      .replace(/\*(.*?)\*/gim, '<em>$1</em>')
      .replace(/\n/g, '<br>');
  }

  document.getElementById("article-content").addEventListener("input", function () {
    const preview = document.getElementById("preview-box");
    preview.innerHTML = renderMarkdown(this.value);
    preview.classList.remove("hidden");
  });

  init();
</script>

</body>
</html>
